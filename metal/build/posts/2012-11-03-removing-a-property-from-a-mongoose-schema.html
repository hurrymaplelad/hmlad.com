<p>This should be simple, but Mongoose really clings to data in existing documents.  I&#39;ll walk through all the ways I wanted it to work that failed.  We&#39;ll remove an <code>organic</code> flag from a toy <code>Food</code> model so we can replace it with <a href="http://www.nytimes.com/2012/10/14/opinion/sunday/bittman-my-dream-food-label.html">Bittman&#39;s dream label</a>.  If you just came for the solution, I arrived at:</p>
<pre><code class="lang-js">Food.collection.update({},
  {$unset: {organic: true}},
  {multi: true, safe: true}
);
</code></pre>
<p><!-- more -->Our well-loved <code>Food</code> schema might look something like:</p>
<pre><code class="lang-js">var Food = db.model(&#39;Food&#39;, new mongoose.Schema({
  name: {type: String, required: true},
  organic: Boolean
}, {
  strict: true
}));
</code></pre>
<p>and it might be populated with documents like organic frozen broccoli:</p>
<pre><code class="lang-js">var broccoli = new Food({
  name: &#39;frozen broccoli&#39;,
  organic: true
});
</code></pre>
<p>Alright, time to get rid of that <code>organic</code> property.  Adding a property with Mongoose is as easy as declaring it in the schema.  Could removing be just as easy?</p>
<pre><code class="lang-diff">  var Food = db.model(&#39;Food&#39;, new mongoose.Schema({
    name: {type: String, required: true},
-   organic: Boolean
  }, {
    strict: true
  }));
</code></pre>
<p>If we reload our broccoli doc, will mongoose strip out the undeclared properties?  We did tell Mongoose to be <code>strict</code> with our <code>Food</code>…</p>
<pre><code class="lang-js">Food.findById(broccoli, function(err, broccoli) {
  console.log(broccoli.get(&#39;organic&#39;));
});

&gt; true
</code></pre>
<p>No.  Too slick.  I suppose it&#39;s comforting that mongoose isn&#39;t silently manipulating our docs.  Maybe we just need to re-save <code>broccoli</code>.  Surely mongoose will be <code>strict</code> now…</p>
<pre><code class="lang-js">broccoli.save(function() {
  Food.findById(broccoli, function(err, broccoli) {
    console.log(broccoli.get(&#39;organic&#39;))
  })
});

&gt; true
</code></pre>
<p>Nope.  <a href="http://grokbase.com/t/gg/mongoose-orm/123ya4qp0a/mongoose-removing-an-existing-field-from-a-collection#20120330swrofqtizat6i3kalhvfrusz5a">Mr. Heckmann rationalizes this behavior</a> as</p>
<blockquote>
<p>Mongoose &quot;plays nice&quot; with existing data in the db, not deleting it unless you tell it to.</p>
</blockquote>
<p>I&#39;ll have to be more explicit with this broccoli, more meticulous with my cleanup.  I&#39;ll unset <code>organic</code> directly.</p>
<pre><code class="lang-js">broccoli.set(&#39;organic&#39;, undefined);
broccoli.save(function() {
  Food.findById(broccoli, function(err, broccoli) {
    console.log(broccoli.get(&#39;organic&#39;));
  });
});

&gt; true
</code></pre>
<p>Wow.  Fine.  Now <code>strict</code> decides to help out.</p>
<p>Mongoose isn&#39;t cooperating.  Time to talk directly to Mongo.  Maybe Mongoose can at least offer me some <a href="http://mongoosejs.com/docs/api.html#model_Model-update">update sugar</a>:</p>
<pre><code class="lang-js">Food.update({},
  {$unset: {organic: true}},
  {multi: true, safe: true},
  function(err) {
    Food.findById(broccoli, function(err, broccoli) {
      console.log(broccoli.get(&#39;organic&#39;));
    });
  }
);

&gt; true
</code></pre>
<p><img src="/images/yuno.jpg" alt="Y U NO UNSET!?"></p>
<p>This must be <code>strict</code> still <a href="https://groups.google.com/d/topic/mongoose-orm/ypvL3Fximjc/discussion">keeping us safe</a>.</p>
<p>Okay.  Last chance Mongoose.  Just give me the collection.</p>
<pre><code class="lang-js">Food.collection.update({},
  {$unset: {organic: true}},
  {multi: true, safe: true},
  function(err) {
    Food.findById(broccoli, function(err, brocolli) {
      console.log(broccoli.get(&#39;organic&#39;));
  }
);

&gt; undefined
</code></pre>
<p>Phew.</p>
<p>Here&#39;s a <a href="https://gist.github.com/4008255">Mocha spec</a> reproducing this frustrating sequence.  How should we make it be better?</p>
